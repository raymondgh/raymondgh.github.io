<html>
<meta charset="UTF-8">
<body>






<div id="container">
	<div class="summary" id="summary">

		<div class="row" id="title-row">
			<div class="column-1">
				<strong>Unique IDs</strong>
			</div>
			<div class="column-2" id="list-of-ids">
				{current-date}
			</div>
		</div>

		<div class="row" id="total-sessions-row">
			<div class="column-1">
				Number of sessions
			</div>
			<div class="column-2" id="total-sessions">
				{Current-Balance}
			</div>
		</div>

				<div class="row" id="rate-row">
			<div class="column-1">
				Average Duration			
			</div>
			<div class="column-2" id="average-session">
				{interest-rate}
			</div>
		</div>

				<div class="row" id="original-row">
			<div class="column-1">
				Selected Item
			</div>
			<div class="column-2" id="selected-item">
				{original-amount}
			</div>
		</div>
<!-- 
				<div class="row" id="disbursement-row">
			<div class="column-1">
				Disbursement Date
			</div>
			<div class="column-2" id="disbursement-date">
				{disbursement-date}
			</div>
		</div> -->
<select id="item-selector" onchange="selectorUpdate()">

</select>




	</div>
</div>











</body>
<script src="events.js" type="text/javascript"></script>


<style>

#container {
	display: flex;
	justify-content: center;
	align-items: center;
	width: 100%;
	height: 100%;
}

.summary {
	display: flex;
	flex-direction: column;
}

.row {
	display: flex;
	flex-direction: row;
	justify-content: space-around;
	height: 30px;
}

.column-1 {
	display: flex;
	width: 1fr;
	width: 150px;
}

.column-2 {
	display: flex;
	width: 2fr;
		width: 150px;
}


#title-row {
	height: 50px;
}





</style>


<script>



//takes a uniqueID and list of events and returns a list of events for that uniqueID
function ownedEvents(uniqueID, events) {
	var owned = [];

	events.forEach(function(event) {
		if (event.userid == uniqueID) {
			owned.push(event);
		}
	});

	return owned
}

//takes a list of event objects and returns a list of event objects with session duration
function durableEvents(events) {

	var durables = [];

	events.forEach(function(event) {
		if (event.custom_params.duration) {
			durables.push(event);
		}
	});

	return durables
}


//takes a list of durable events and returns their average duration
function averageDurationOfEvents(events) {

	var totalTime = 0
	events.forEach(function(event) {
		totalTime += parseInt(event.custom_params.duration, 10)
	})


	return (totalTime / events.length).toFixed(2)
}


//takes a list of event objects and returns a list of unique IDs appearing in that list
function uniqueIDs(events) {
	var listOfUserIDs = [];

	events.forEach(function(item){
		listOfUserIDs.push(item.userid)
	})


	return Array.from(new Set(listOfUserIDs))
}



//takes a list of json objects and returns all the top level keys for the objects in the list

function jsonKeys (json) {

	var moreKeys = []

	json.forEach(function(item){
		moreKeys.push(Object.keys(item)) //.custom_params)
	})

	return Array.from(new Set([].concat.apply([], moreKeys)))
}



//takes a key and produces an html option element
function createOptionElement(key) {
	var optionElement = document.createElement("option")
	optionElement.setAttribute("value", key);
	optionElement.innerHTML = key;
	return optionElement
}

//takes a list of keys and produces a list of html option elements

function createOptionElementList (listOfKeys) {
	var options = []
	for (var i = listOfKeys.length - 1; i >= 0; i--) {
		options.push(createOptionElement(listOfKeys[i]))
	}
	return options
}


//takes list of option elements and a parent element and appends the options as chiledren to the parent
function listOptions(listOfOptionElements, parentID) {
	listOfOptionElements.forEach(function(element){
		document.getElementById(parentID).appendChild(element)
	})
}







// takes a json key and list of parent/uncle objects and returns all the keys of the child json object
function childrenKeys(parentKey, json) {
	var children = []

	json.forEach(function(event) {
		children.push(event.custom_params)

	})
	return children
}



// create new select element
function createSelectElement(listOfKeys) {
	var selectElement = document.createElement("select")
	selectElement.setAttribute("onchange", "selector2Update()")
	selectElement.setAttribute("id", document.getElementById("selected-item").innerHTML)
	return selectElement
}

//display new select element
function displaySelectElement(element, parentID) {
	document.getElementById(parentID).appendChild(element)
}




//takes a json key and object and returns a list of values from the json object for that key
function valuesForKey(key, events) {
	var values = [];

	events.forEach(function(item){
		values.push(item.key)
	})


	return Array.from(new Set (values))
}

//update selector representation
function selectorUpdate(){

	var selectorID = "item-selector"

	var selectedDisplay = document.getElementById("selected-item")
	var selectorElement = document.getElementById(selectorID)

	selectedDisplay.innerHTML = selectorElement.value;

	displaySelectElement(createSelectElement(selectedDisplay.innerHTML),"summary")


listTier2Options()

	return document.getElementById("item-selector").value

}


//optionlister2
function listTier2Options (){
	listOptions(createOptionElementList(jsonKeys(childrenKeys("custom_params",eventsJSON))),"custom_params")
}


//selector2
function selector2Update(){
	console.log("trick or treat")
}

window.onload = document.getElementById("list-of-ids").innerHTML = uniqueIDs(eventsJSON)
window.onload = document.getElementById("total-sessions").innerHTML = durableEvents(eventsJSON).length
window.onload = document.getElementById("average-session").innerHTML = averageDurationOfEvents(durableEvents(eventsJSON))
window.onload = listOptions(createOptionElementList(jsonKeys(eventsJSON)),"item-selector")





// function() {
// 	var newReleases = [
// 			{
// 				"id": 70111470,
// 				"title": "Die Hard",
// 				"boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
// 				"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
// 				"rating": [4.0],
// 				"bookmark": []
// 			},
// 			{
// 				"id": 654356453,
// 				"title": "Bad Boys",
// 				"boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
// 				"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
// 				"rating": [5.0],
// 				"bookmark": [{ id: 432534, time: 65876586 }]
// 			},
// 			{
// 				"id": 65432445,
// 				"title": "The Chamber",
// 				"boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
// 				"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
// 				"rating": [4.0],
// 				"bookmark": []
// 			},
// 			{
// 				"id": 675465,
// 				"title": "Fracture",
// 				"boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
// 				"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
// 				"rating": [5.0],
// 				"bookmark": [{ id: 432534, time: 65876586 }]
// 			}
// 		];

//   return newReleases.map(function(video) { return { id: video.id, title: video.title }; });
// }
		


// events.map(function(event) {return {event.custom_params.duration}; });



</script>
</html>